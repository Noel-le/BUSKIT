// datetime
var day = new Date();	
var week = new Array('일','월','화','수','목','금','토');

// get current time
var hours = day.getHours(); 
var minutes = day.getMinutes();
var seconds = day.getSeconds(); 
var now_time = hours * 3600 + minutes * 60  + seconds;


//get elements
const get = (target) => {
    return document.querySelector(target);
};

const $info = get(".bus-info");

const createInfoElement = (number,time) => {
    const routeno = number
    const arrtime = time
    const $busInfo = document.createElement("div");
    $busInfo.classList.add("bus-item");
    $busInfo.innerHTML = `
      <div class = 'bus-number'>${routeno}번</div>
        <li>도착예정시간</li> 
        <li>${arrtime}</li> 
        `;   
    return $busInfo;
}

const $info2 = get(".popup");
const createPopup = (number,time) => {
    const $popupList = document.createElement("div");
    $popupList.classList.add("content_area");
    $popupList.innerHTML = `
    <li class = 'busNum'>${number}</li>
    <ul>
        <li class = 'arrTime'>도착예정시간</li> 
        <li class = 'arrTime'>${time}</li>
    </ul>
    `
return $popupList
}

const renderAllinfo = (number, time) => {
    $info.innerHTML = "";
    const InfoElement = createInfoElement(number,time);
    $info.appendChild(InfoElement); 
};


const renderpopup = (number, time) => {
    $info2.innerHTML += "";
    const popupElement = createPopup(number,time);
    $info2.appendChild(popupElement); 
};



//display popup
const $dimmed_layer = get('.dimmed-layer')
const $nodeBtn = get('.nodeBtn')
const $popup  = get('.popup')
const popup = (number, time) =>{
    $nodeBtn.addEventListener("click",()=>{
          $dimmed_layer.classList.add("display")
          $popup.classList.add("show")
          $dimmed_layer.addEventListener("click",()=>{
            $dimmed_layer.classList.remove("display")
            $popup.classList.remove("show")
          })
          for(let i = 0; i < number.length; i++){
            renderpopup(number[i],time[i])
          }
        })
}

// Gumi station to School
const st_sc = () => {

  // bus_number && time data list
  // weekday
  var t1 = ['6:05:00', '6:10:00', '6:18:00', '6:33:00', '6:35:00', '6:50:00', '6:55:00', '7:00:00', '7:04:00', '7:10:00', '7:32:00', '7:37:00', '7:42:00', '7:46:00', '8:05:00', '8:06:00', '8:10:00', '8:22:00', '8:32:00', '8:35:00', '8:40:00', '8:50:00', '8:55:00', '9:05:00', '9:08:00', '9:16:00', '9:48:00', '9:57:00', '10:00:00', '10:05:00', '10:10:00', '10:38:00', '10:46:00', '10:50:00', '11:10:00', '11:17:00', '11:36:00', '11:45:00', '11:52:00', '11:53:00', '12:20:00', '12:23:00', '12:25:00', '12:35:00', '12:37:00', '12:52:00', '12:58:00', '13:15:00', '13:16:00', '13:25:00', '13:26:00', '13:27:00', '13:37:00', '13:51:00', '14:00:00', '14:06:00', '14:33:00', '14:35:00', '14:37:00', '14:45:00', '15:05:00', '15:20:00', '15:25:00', '15:36:00', '15:47:00', '16:07:00', '16:15:00', '16:21:00', '16:37:00', '16:55:00', '17:15:00', '17:17:00', '17:40:00', '17:56:00', '17:57:00', '17:59:00', '18:07:00', '18:20:00', '18:25:00', '18:40:00', '18:45:00', '18:53:00', '19:00:00', '19:05:00', '19:25:00', '19:31:00', '19:50:00', '19:52:00', '20:06:00', '20:15:00', '20:46:00', '20:50:00', '20:53:00', '21:05:00', '21:15:00', '21:50:00']
  var n1 = ['195', '190-3', '190-3', '193', '196', '190-3', '190-3', '195', '57', '196', '5200', '57', '557', '190-2', '196', '57', '191', '57', '5200', '192', '900', '190', '193', '195', '196', '900', '196', '57', '190', '195', '192', '191', '900', '192', '196', '190', '900', '193', '190-3', '196', '195', '190', '192', '196', '190-3', '57', '190-3', '195', '900', '190-3', '57', '191', '557', '900', '196', '51-1', '193', '192', '190', '196', '191', '195', '196', '190, 900', '57', '57', '191, 195', '900', '5200', '190, 196', '193', '57', '190-3, 196', '900', '190-3, 5200', '191', '57', '196', '192', '195', '51-1, 190-3', '193-2, 900', '191', '192', '195', '190-1', '196', '57', '900', '193', '900', '51-1', '191', '196', '190', '192']
  var time1 = [21900, 22200, 22680, 23580, 23700, 24600, 24900, 25200, 25440, 25800, 27120, 27420, 27720, 27960, 29100, 29160, 29400, 30120, 30720, 30900, 31200, 31800, 32100, 32700, 32880, 33360, 35280, 35820, 36000, 36300, 36600, 38280, 38760, 39000, 40200, 40620, 41760, 42300, 42720, 42780, 44400, 44580, 44700, 45300, 45420, 46320, 46680, 47700, 47760, 48300, 48360, 48420, 49020, 49860, 50400, 50760, 52380, 52500, 52620, 53100, 54300, 55200, 55500, 56160, 56820, 58020, 58500, 58860, 59820, 60900, 62100, 62220, 63600, 64560, 64620, 64740, 65220, 66000, 66300, 67200, 67500, 67980, 68400, 68700, 69900, 70260, 71400, 71520, 72360, 72900, 74760, 75000, 75180, 75900, 76500, 78600]
 
  // holiday
  var t3 = ['6:05:00', '6:10:00', '6:18:00', '6:33:00', '6:35:00', '6:50:00', '6:55:00', '7:00:00', '7:04:00', '7:10:00', '7:32:00', '7:35:00', '7:37:00', '7:42:00', '8:04:00', '8:05:00', '8:06:00', '8:22:00', '8:32:00', '8:40:00', '8:45:00', '8:55:00', '9:05:00', '9:08:00', '9:16:00', '9:48:00', '9:57:00', '10:05:00', '10:10:00', '10:35:00', '10:46:00', '11:10:00', '11:36:00', '11:45:00', '11:52:00', '11:53:00', '12:20:00', '12:35:00', '12:37:00', '12:52:00', '12:58:00', '13:15:00', '13:16:00', '13:25:00', '13:26:00', '13:33:00', '13:37:00', '13:51:00', '14:00:00', '14:06:00', '14:32:00', '14:33:00', '14:45:00', '14:50:00', '15:00:00', '15:20:00', '15:23:00', '15:25:00', '15:36:00', '15:47:00', '16:00:00', '16:07:00', '16:15:00', '16:20:00', '16:21:00', '16:37:00', '16:50:00', '16:55:00', '17:15:00', '17:17:00', '17:40:00', '17:50:00', '17:56:00', '17:57:00', '18:07:00', '18:20:00', '18:40:00', '18:45:00', '18:53:00', '19:05:00', '19:25:00', '19:30:00', '19:50:00', '19:52:00', '20:06:00', '20:15:00', '20:46:00', '20:50:00', '20:55:00', '21:05:00', '21:10:00', '21:50:00']
  var n3 = ['195', '190-3', '190-3', '193', '196', '190-3', '190-3', '192, 195', '57', '196', '5200', '190', '57', '557', '191', '196', '57', '57', '5200', '900', '190', '193', '195', '196', '900', '196', '57, 190', '195', '192', '191', '900', '190, 196', '900', '193', '190-3', '196', '190, 192, 195', '196', '190-3', '57', '190-3', '195', '900', '190-3', '57', '191', '557', '900', '196', '51-1', '190', '193', '196', '192', '191', '195', '190', '196', '900', '57', '192', '57', '195', '191', '900', '5200', '190', '196', '193', '57', '190-3, 196', '191', '900', '190-3, 5200', '57', '196', '195', '51-1, 190-3', '193-2, 900', '191', '195', '190-1', '196', '57', '900', '193', '900', '51-1', '191', '196', '190', '192']
  var time3 = [21900, 22200, 22680, 23580, 23700, 24600, 24900, 25200, 25440, 25800, 27120, 27300, 27420, 27720, 29040, 29100, 29160, 30120, 30720, 31200, 31500, 32100, 32700, 32880, 33360, 35280, 35820, 36300, 36600, 38100, 38760, 40200, 41760, 42300, 42720, 42780, 44400, 45300, 45420, 46320, 46680, 47700, 47760, 48300, 48360, 48780, 49020, 49860, 50400, 50760, 52320, 52380, 53100, 53400, 54000, 55200, 55380, 55500, 56160, 56820, 57600, 58020, 58500, 58800, 58860, 59820, 60600, 60900, 62100, 62220, 63600, 64200, 64560, 64620, 65220, 66000, 67200, 67500, 67980, 68700, 69900, 70200, 71400, 71520, 72360, 72900, 74760, 75000, 75300, 75900, 76200, 78600]

  
  // info display

  if ((week[day.getDay()] ==="토") || (week[day.getDay()] === "일")){
    var n = 0;
    for (var i = 0; i <= t3.length; i++){
      if ((time3[n] < now_time) && (now_time <= time3[n+1])){
        renderAllinfo(n3[n+1],t3[n+1])
        // popup(n3,t3)
        // n = n+1;
        if(n >= 91){ //92
          document.write('<p style="font-size: 30px; text-align: center;">운행종료<br></p>');
        }else{
            renderAllinfo(n3[n+1],t3[n+1])
        }
      }else{
        n = n+1;
      }         
    }
    popup(n3,t3)
  }else{
    var n = 0;
    for (var i = 0; i <= t1.length; i++){
      if ((time1[n] < now_time) && (now_time <= time1[n+1])){
        renderAllinfo(n1[n+1],t1[n+1])
        // popup(n1,t1)
        // n = n+1;
        if(n >= 95){ //96
          document.write('<p style="font-size: 30px; text-align: center;">운행종료<br></p>');
        }else{
            renderAllinfo(n1[n+1],t1[n+1])
        }
      }else{
        n = n+1;
      }
    }   
  }popup(n1,t1)
}


const init = () => {
  window.addEventListener("DOMContentLoaded", () => {
      // sc_st()
      st_sc()
  });
};  
init();